<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>第三章 AOP 基于@Aspect的AOP | 笨笨个人笔记</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="/css/main.css?v=1.0.4"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body style="background:#fbfbfb;"><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">第三章 AOP 基于@Aspect的AOP</h1><a id="logo" href="/.">笨笨个人笔记</a><p class="description">ibenben.org</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">第三章 AOP 基于@Aspect的AOP</h1><div class="post-meta">Jul 8, 2013<span> | </span><span class="category"><a href="/categories/Spring/">Spring</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><p>在前面，我们分别使用Pointcut、Advice、Advisor接口来描述切点、增强、切面。而现在我们使用@Adpect注解来描述。</p>
<p>在下面的例子中，我们是使用Spring自动扫描和管理Bean。</p>
<p>（<a href="http://blog.csdn.net/p_3er/article/details/9239605）" target="_blank" rel="noopener">http://blog.csdn.net/p_3er/article/details/9239605）</a></p>
<h2 id="3-6-1一个简单的例子"><a href="#3-6-1一个简单的例子" class="headerlink" title="3.6.1一个简单的例子"></a>3.6.1一个简单的例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Repository</span><br><span class="line">public class UserDaoImpl implements UserDao &#123;</span><br><span class="line">	public void save() &#123;</span><br><span class="line">		System.out.println(&quot;保存用户...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void delete() &#123;</span><br><span class="line">		System.out.println(&quot;删除用户...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POJO</p>
<p>@AspectJ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * 通过@Aspect把这个类标识管理一些切面</span><br><span class="line"> */</span><br><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class FirstAspect &#123;	</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">	 * 定义切点及增强类型</span><br><span class="line">	 */</span><br><span class="line">	@Before(&quot;execution(* save(..))&quot;)</span><br><span class="line">	public void before()&#123;</span><br><span class="line">		System.out.println(&quot;我是前置增强...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>配置的时候要引入aop命名空间及打开@Aspect切面驱动器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;	</span><br><span class="line">	&lt;context:component-scan base-package=&quot;cn.framelife.spring&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line">	&lt;!—</span><br><span class="line">驱动器自动为Spring容器中那些匹配@AspectJ切面的Bean创建代理，完成切面积入 </span><br><span class="line">--&gt;</span><br><span class="line">	&lt;aop:aspectj-autoproxy/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		UserDao userDao = (UserDao) context.getBean(&quot;userDaoImpl&quot;);</span><br><span class="line">		userDao.save();</span><br><span class="line">		userDao.delete();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">我是前置增强...</span><br><span class="line">保存用户...</span><br><span class="line">删除用户...</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-6-2增强类型及其使用"><a href="#3-6-2增强类型及其使用" class="headerlink" title="3.6.2增强类型及其使用"></a>3.6.2增强类型及其使用</h2><h2 id="Before前置增强"><a href="#Before前置增强" class="headerlink" title="@Before前置增强"></a>@Before前置增强</h2><p>@Before(value= “切入点表达式或命名切入点”,argNames<br> = “指定命名切入点方法参数列表参数名字，可以有多个用“,”分隔”)</p>
<p>3.6.1中的增强使用：@Before(value=”execution(*save(..))”)是缺省了value，直接键入值。</p>
<p>a、目标类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class UserService &#123;</span><br><span class="line">	public void say(String name)&#123;</span><br><span class="line">		System.out.println(&quot;service say:&quot;+name);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void run(String way)&#123;</span><br><span class="line">		System.out.println(&quot;service run:&quot;+way);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POJO</p>
<p>@AspectJ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class BeforAspectj &#123;</span><br><span class="line">	</span><br><span class="line">/*</span><br><span class="line">	 *单独配置切点。给切点命名。</span><br><span class="line">*/</span><br><span class="line">	@Pointcut(value=&quot;execution(* say(..)) &amp;&amp; args(param)&quot;,argNames=&quot;param&quot;)</span><br><span class="line">	public void beforePointcut(String param)&#123; &#125;</span><br><span class="line">	</span><br><span class="line">	@Before(value=&quot;beforePointcut(s)&quot;,argNames=&quot;s&quot;)</span><br><span class="line">	public void beforeAdvice(String s)&#123;</span><br><span class="line">		System.out.println(&quot;beforeAdvice:&quot;+s);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class BeforAspectj &#123;</span><br><span class="line">	@Before(value=&quot;execution(* say(..)) &amp;&amp; args(s)&quot;,argNames=&quot;s&quot;)</span><br><span class="line">	public void beforeAdvice(String s)&#123;</span><br><span class="line">		System.out.println(&quot;beforeAdvice:&quot;+s);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;	</span><br><span class="line">	&lt;context:component-scan base-package=&quot;cn.framelife.spring&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">	&lt;aop:aspectj-autoproxy/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		UserService service = (UserService) context.getBean(&quot;userService&quot;);</span><br><span class="line">		service.say(&quot;zhangsan&quot;);</span><br><span class="line">		service.run(&quot;street&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">beforeAdvice:zhangsan</span><br><span class="line">service say:zhangsan</span><br><span class="line">service run:street</span><br></pre></td></tr></table></figure>
<h2 id="AfterReturning后置增强"><a href="#AfterReturning后置增强" class="headerlink" title="@AfterReturning后置增强"></a>@AfterReturning后置增强</h2><p>@AfterReturning(</p>
<p>value=”切入点表达式或命名切入点”,</p>
<p>pointcut=”切入点表达式或命名切入点”,</p>
<p>argNames=”参数列表参数名”,</p>
<p>returning=”目标对象的返回值”)</p>
<p>pointcut与value是一样的。如果使用pointcut来声明，那么前面声明的value就没用了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class UserService &#123;</span><br><span class="line">	public void say(String name)&#123;</span><br><span class="line">		System.out.println(&quot;service say:&quot;+name);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void run(String way)&#123;</span><br><span class="line">		System.out.println(&quot;service run:&quot;+way);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public String getName(String name)&#123;</span><br><span class="line">		System.out.println(&quot;service getName:&quot;+name);</span><br><span class="line">		return &quot;MR&quot;+name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POJO</p>
<p>@AspectJ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class AfterReturningAspectj &#123;</span><br><span class="line">	/*</span><br><span class="line">	 * 即获取返回值，又获取传入的参数</span><br><span class="line">	 */</span><br><span class="line">	@AfterReturning(</span><br><span class="line">			value=&quot;execution(* cn.framelife.spring..*.getName(..)) &amp;&amp; args(sname)&quot;,</span><br><span class="line">			returning=&quot;name&quot;,</span><br><span class="line">			argNames=&quot;name,sname&quot;)</span><br><span class="line">	public void afterGetNameAdvice(Object object,String sname)&#123;</span><br><span class="line">		System.out.println(&quot;afterGetNameAdvice:&quot;+ (String)object+&quot;--&quot;+sname);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	/*</span><br><span class="line">	 * 只要增强，返回值和参数都不理会</span><br><span class="line">	 */</span><br><span class="line">	@AfterReturning(value=&quot;execution(* cn.framelife.spring..*.run(..))&quot;)</span><br><span class="line">	public void afterRunAdvice()&#123;</span><br><span class="line">		System.out.println(&quot;afterRunAdvice&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;	</span><br><span class="line">	&lt;context:component-scan base-package=&quot;cn.framelife.spring&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">	&lt;aop:aspectj-autoproxy/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		UserService service = (UserService) context.getBean(&quot;userService &quot;);</span><br><span class="line">		service.getName(&quot;zhangsan&quot;);</span><br><span class="line">		service.run(&quot;street&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">servicegetName:zhangsan</span><br><span class="line">afterGetNameAdvice:MRzhangsan--zhangsan</span><br><span class="line">servicerun:steet</span><br><span class="line">afterRunAdvice</span><br></pre></td></tr></table></figure>
<h2 id="AfterThrowing异常抛出增强、-After-Final增强"><a href="#AfterThrowing异常抛出增强、-After-Final增强" class="headerlink" title="@AfterThrowing异常抛出增强、@After Final增强"></a>@AfterThrowing异常抛出增强、@After Final增强</h2><p>@AfterThrowing(</p>
<p>value=”切入点表达式或命名切入点”,</p>
<p>pointcut=”切入点表达式或命名切入点”,</p>
<p>argNames=”参数列表参数名”,</p>
<p>throwing=”异常对应参数名”)</p>
<p>@After( value=”切入点表达式或命名切入点”,argNames=”参数列表参数名”)</p>
<p>@After不管是抛出异常或者是正常退出，该增强都会执行。相当于try-catch-final里的final代码块。</p>
<p>a、目标类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class UserService &#123;</span><br><span class="line">	public void tryThrow()&#123;</span><br><span class="line">		System.out.println(&quot;service tryThrow&quot;);</span><br><span class="line">		throw new RuntimeException(&quot;i am a runtime exception&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POJO</p>
<p>@AspectJ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class ThrowAspectj &#123;</span><br><span class="line">	@AfterThrowing(value=&quot;execution(* cn.framelife.spring..tryThrow(..))&quot;,</span><br><span class="line">			throwing=&quot;exception&quot;,</span><br><span class="line">			argNames=&quot;exception&quot;)</span><br><span class="line">	public void afterThrowAdvisor(Exception exception)&#123;</span><br><span class="line">		System.out.println(&quot;afterThrowAdvisor:&quot;+exception.getMessage());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@After(value=&quot;execution(* cn.framelife.spring..tryThrow(..))&quot;)</span><br><span class="line">	public void finalThrowAdvisor()&#123;</span><br><span class="line">		System.out.println(&quot;finalThrowAdvisor&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;	</span><br><span class="line">	&lt;context:component-scan base-package=&quot;cn.framelife.spring&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">	&lt;aop:aspectj-autoproxy/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		UserService service = (UserService) context.getBean(&quot;userService &quot;);</span><br><span class="line">		service.tryThrow();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">servicetryThrow</span><br><span class="line">afterThrowAdvisor:iam a runtime exception</span><br><span class="line">finalThrowAdvisor</span><br><span class="line">Exceptionin thread &quot;main&quot; java.lang.RuntimeException:i am a runtime exception</span><br></pre></td></tr></table></figure>
<h2 id="Around环绕增强"><a href="#Around环绕增强" class="headerlink" title="@Around环绕增强"></a>@Around环绕增强</h2><p>@Around( value=”切入点表达式或命名切入点”,argNames=”参数列表参数名”)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class UserService &#123;</span><br><span class="line">	public void round()&#123;</span><br><span class="line">		System.out.println(&quot;service round&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void run(String way)&#123;</span><br><span class="line">		System.out.println(&quot;service run:&quot;+way);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public String getName(String name)&#123;</span><br><span class="line">		System.out.println(&quot;service getName:&quot;+name);</span><br><span class="line">		return &quot;MR&quot;+name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POJO</p>
<p>@AspectJ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class AroundAspect &#123;</span><br><span class="line">	</span><br><span class="line">	@Around(value=&quot;execution(* cn.framelife.spring..round(..))&quot;)</span><br><span class="line">	public Object aroundAdvisor(ProceedingJoinPoint point) throws Throwable&#123;</span><br><span class="line">		System.out.println(&quot;before method&quot;);</span><br><span class="line">		Object target = point.proceed();</span><br><span class="line">		System.out.println(&quot;after method&quot;);</span><br><span class="line">		return target;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;	</span><br><span class="line">	&lt;context:component-scan base-package=&quot;cn.framelife.spring&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">	&lt;aop:aspectj-autoproxy/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		UserService service = (UserService) context.getBean(&quot;userService&quot;);</span><br><span class="line">		service.round();</span><br><span class="line">		service.run(&quot;street&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">beforemethod</span><br><span class="line">serviceround</span><br><span class="line">aftermethod</span><br><span class="line">servicerun:street</span><br><span class="line">afterRunAdvice</span><br></pre></td></tr></table></figure>
<h2 id="DeclareParents引介增强"><a href="#DeclareParents引介增强" class="headerlink" title="@DeclareParents引介增强"></a>@DeclareParents引介增强</h2><p>@DeclareParents(</p>
<p>value=”AspectJ语法类型表达式”,</p>
<p>defaultImpl=引入接口的默认实现类)</p>
<p>下面的例子是Waiter为目标类，然后让目标类拥有ISeller接口的功能：</p>
<p>目标类与其接口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface IWaiter &#123;</span><br><span class="line">	public void service();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class Waiter implements IWaiter &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void service() &#123;</span><br><span class="line">		System.out.println(&quot;service&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行期织入到目标类的功能类与其接口：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface ISeller &#123;</span><br><span class="line">	public void sell();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Seller implements ISeller &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void sell() &#123;</span><br><span class="line">		System.out.println(&quot;sell&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POJO</p>
<p>@AspectJ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class DeclareAspect &#123;</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">	 * value里面配置目标类</span><br><span class="line">	 * defaultImpl是功能类的实现类</span><br><span class="line">	*/</span><br><span class="line">	@DeclareParents(</span><br><span class="line">			value=&quot;cn.framelife.spring.aspectj.Waiter&quot;,</span><br><span class="line">			defaultImpl=Seller.class)</span><br><span class="line">	private ISeller seller; //使用功能类接口声明一个对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;	</span><br><span class="line">	&lt;context:component-scan base-package=&quot;cn.framelife.spring&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">	&lt;aop:aspectj-autoproxy/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		IWaiter waiter = (IWaiter) context.getBean(&quot;waiter&quot;);</span><br><span class="line">		waiter.service();</span><br><span class="line">		ISeller seller = (ISeller)waiter;</span><br><span class="line">		seller.sell();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service</span><br><span class="line">sell</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-6-3切点函数"><a href="#3-6-3切点函数" class="headerlink" title="3.6.3切点函数"></a>3.6.3切点函数</h2><p>带@开头的函数都是针对注解类的。而不带@的函数是针对普通类的。</p>
<h2 id="execution"><a href="#execution" class="headerlink" title="execution()"></a>execution()</h2><p>execution(&lt;修饰符模式&gt;?&lt;返回类型模式&gt;&lt;方法名模式&gt;(&lt;参数模式&gt;)&lt;异常模式&gt;?)</p>
<p>除了返回类型模式、方法名模式和参数模式外，其它都是可选的。<br><strong>1)通过方法签名定义切点</strong></p>
<p>execution(public<em> </em>(..))</p>
<p>匹配所有目标类的public方法，但不匹配SmartSeller和protectedvoid<br> showGoods()方法。第一个<em>代表返回类型，第二个</em>代表方法名，而..代表任意入参的方法；</p>
<p>execution(<em> </em>To(..))</p>
<p>匹配目标类所有以To为后缀的方法。它匹配NaiveWaiter和NaughtyWaiter的greetTo()和serveTo()方法。第一个<em>代表返回类型，而</em>To代表任意以To为后缀的方法；</p>
<p><strong>2)通过类定义切点</strong></p>
<p>execution(<em>com.baobaotao.Waiter.</em>(..))</p>
<p>匹配Waiter接口的所有方法，它匹配NaiveWaiter和NaughtyWaiter类的greetTo()和serveTo()方法。第一个<em>代表返回任意类型，com.baobaotao.Waiter.</em>代表Waiter接口中的所有方法；</p>
<p>execution(<em>com.baobaotao.Waiter+.</em>(..))</p>
<p>匹配Waiter接口及其所有实现类的方法，它不但匹配NaiveWaiter和NaughtyWaiter类的greetTo()和serveTo()这两个Waiter接口定义的方法，同时还匹配NaiveWaiter#smile()和NaughtyWaiter#joke()这两个不在Waiter接口中定义的方法。</p>
<p><strong>3)通过类包定义切点</strong></p>
<p>在类名模式串中，“.<em>”表示包下的所有类，而“..</em>”表示包、子孙包下的所有类。</p>
<p>execution(<em>com.baobaotao.</em>(..))</p>
<p>匹配com.baobaotao包下所有类的所有方法；</p>
<p>execution(<em>com.baobaotao..</em>(..))</p>
<p>匹配com.baobaotao包、子孙包下所有类的所有方法，如com.baobaotao.dao，com.baobaotao.servier以及com.baobaotao.dao.user包下的所有类的所有方法都匹配。“..”出现在类名中时，后面必须跟“*”，表示包、子孙包下的所有类；</p>
<p>execution(<em>com..</em>.<em>Dao.find</em>(..))</p>
<p>匹配包名前缀为com的任何包下类名后缀为Dao的方法，方法名必须以find为前缀。如com.baobaotao.UserDao#findByUserId()、com.baobaotao.dao.ForumDao#findById()的方法都匹配切点。</p>
<p><strong>4)通过方法入参定义切点</strong></p>
<p>切点表达式中方法入参部分比较复杂，可以使用“<em>”和“..”通配符，其中“</em>”表示任意类型的参数，而“..”表示任意类型参数且参数个数不限。</p>
<p>execution(*joke(String,int)))</p>
<p>匹配joke(String,int)方法，且joke()方法的第一个入参是String，第二个入参是int。它匹配NaughtyWaiter#joke(String,int)方法。如果方法中的入参类型是java.lang包下的类，可以直接使用类名，否则必须使用全限定类名，如joke(java.util.List,int)；</p>
<p>execution(<em>joke(String,</em>)))</p>
<p>匹配目标类中的joke()方法，该方法第一个入参为String，第二个入参可以是任意类型，如joke(Strings1,String<br> s2)和joke(Strings1,double d2)都匹配，但joke(Strings1,double<br> d2,String s3)则不匹配；</p>
<p>execution(*joke(String,..)))</p>
<p>匹配目标类中的joke()方法，该方法第一个入参为String，后面可以有任意个入参且入参类型不限，如joke(Strings1)、joke(Strings1,String<br> s2)和joke(Strings1,double d2,String s3)都匹配。</p>
<p>execution(*joke(Object+)))</p>
<p>匹配目标类中的joke()方法，方法拥有一个入参，且入参是Object类型或该类的子类。它匹配joke(Strings1)和joke(Clientc)。如果我们定义的切点是execution(*joke(Object))，则只匹配joke(Objectobject)而不匹配joke(Stringcc)或joke(Clientc)。</p>
<h2 id="args"><a href="#args" class="headerlink" title="args()"></a>args()</h2><p>该函数的入参是一个类名，表示目标类的方法入参对象是指定的类（包含子类），切点匹配。它允许类后后使用+通配符后缀，但添加也不添加+效果是一样的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public class User implements Serializable &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class UserService &#123;</span><br><span class="line">	public void say(User user)&#123;</span><br><span class="line">		System.out.println(&quot;say&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POJO</p>
<p>@AspectJ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class BeforAspectj &#123;</span><br><span class="line">	@Before(value=&quot;args(cn.framelife.spring.aspectj.User)&quot;)</span><br><span class="line">	public void beforeAdvice()&#123;</span><br><span class="line">		System.out.println(&quot;beforeAdvice&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;	</span><br><span class="line">	&lt;context:component-scan base-package=&quot;cn.framelife.spring&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">	&lt;aop:aspectj-autoproxy/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		UserService service = (UserService) context.getBean(&quot;userService&quot;);</span><br><span class="line">		service.say(new User());</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">beforeAdvice</span><br><span class="line">say</span><br></pre></td></tr></table></figure>
<h2 id="within"><a href="#within" class="headerlink" title="within()"></a>within()</h2><p>通过类的匹配模式串声明切点。该函数定义的连接点是针对目标类（不能是接口）而言，而不是针对运行时的对象，这与execution()函数相同。Execution()所指定的连接点可以是小到参数，而within()指定的连接点最小只能是类。</p>
<p>within(cn.framelife.spring.aspectj.UserService)</p>
<p>匹配UserService类下所有的方法。</p>
<p>within(cn.framelife.spring.aspectj.*)</p>
<p>匹配cn.framelife.spring.aspectj包下所的的类，但不包括子孙包。cn.framelife.spring.aspectj.abc.AbcService是不匹配的。</p>
<p>within(cn.framelife.spring.aspectj..*)</p>
<p>匹配cn.framelife.spring.aspectj包及其子孙包下所的的类。</p>
<h2 id="target-与this"><a href="#target-与this" class="headerlink" title="target()与this()"></a>target()与this()</h2><p>target()函数是通过判断目标类是否按类型匹配指定类决定连接点是否匹配。</p>
<p>target(cn.framelife.spring.aspectj.UserService)</p>
<p>匹配这UserService类及其子孙类的所有方法。如果UserService是一个接口，那么会匹配UserService的实现类及实现类的子孙类中的所有的方法。</p>
<p>this()函数是通过判断代理类是否按类型匹配指定类决定连接点是否匹配。</p>
<p>一般情况下，使用this()和target()定义切点，两者是等效的：</p>
<p>target(cn.framelife.spring.aspectj.UserService)与this(cn.framelife.spring.aspectj.UserService)是一样的。无论UserService是一个类还是一个接口。</p>
<p>两者区别体现在通过引介切面产生代理对象时。</p>
<h2 id="annotation"><a href="#annotation" class="headerlink" title="@annotation()"></a>@annotation()</h2><p>表示标注了某个自定义注解的方法，使用切面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Retention(value=RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(value=ElementType.METHOD)</span><br><span class="line">public @interface BeforeAdvisor &#123;</span><br><span class="line">	boolean value() default false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POJO</p>
<p>@AspectJ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class BeforAspectj &#123;</span><br><span class="line">	@Before(value=&quot;@annotation(cn.framelife.spring.aspectj.annotation.BeforeAdvisor)&quot;)</span><br><span class="line">	public void beforeAdvice()&#123;</span><br><span class="line">		System.out.println(&quot;beforeAdvice&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;	</span><br><span class="line">	&lt;context:component-scan base-package=&quot;cn.framelife.spring&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">	&lt;aop:aspectj-autoproxy/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class UserService &#123;</span><br><span class="line">	@BeforeAdvisor</span><br><span class="line">	public void annotation()&#123;</span><br><span class="line">		System.out.println(&quot;annotation&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		UserService service = (UserService) context.getBean(&quot;userService&quot;);</span><br><span class="line">		service.annotation();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">beforeAdvice</span><br><span class="line">annotation</span><br></pre></td></tr></table></figure>
<h2 id="args-1"><a href="#args-1" class="headerlink" title="@args()"></a>@args()</h2><p>该函数的入参是一个注解类的类名，表示运行时目标类方法的入参对象的类标注了指定的注解。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Retention(value=RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(value=ElementType.TYPE)</span><br><span class="line">public @interface UserAnnotation &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>b、切面管理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class BeforAspectj &#123;</span><br><span class="line">	@Before(value=&quot;@args(cn.framelife.spring.aspectj.annotation.UserAnnotation)&quot;)</span><br><span class="line">	public void beforeAdvice()&#123;</span><br><span class="line">		System.out.println(&quot;beforeAdvice&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@UserAnnotation</span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class UserService &#123;</span><br><span class="line">	</span><br><span class="line">	public void annotation()&#123;</span><br><span class="line">		System.out.println(&quot;annotation&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void say(User user)&#123;</span><br><span class="line">		System.out.println(&quot;say&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;	</span><br><span class="line">	&lt;context:component-scan base-package=&quot;cn.framelife.spring&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">	&lt;aop:aspectj-autoproxy/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		UserService service = (UserService) context.getBean(&quot;userService&quot;);</span><br><span class="line">		service.say(new User());</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">beforeAdvice</span><br><span class="line">say</span><br></pre></td></tr></table></figure>
<h2 id="within和-target"><a href="#within和-target" class="headerlink" title="@within和@target()"></a>@within和@target()</h2><p>@winthin(A)匹配任意标注了@A的目标类。@target(A)匹配@A的类及子孙类。</p>
<p>@annotation是标注在目标类的方法</p>
<p>@args是标注目标类方法的入参对象的类</p>
<p>@winthin与@target是标注目标类</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>上面的函数（特别是args()）除了可以指定类名外，还可以指定参数名，将目标对象连接点上的方法入参绑定到增强的方法中。如：@Before中的例子。</p>
<hr>
<h2 id="3-6-4通配符与逻辑运算符"><a href="#3-6-4通配符与逻辑运算符" class="headerlink" title="3.6.4通配符与逻辑运算符"></a>3.6.4通配符与逻辑运算符</h2><h2 id="Aspect支持3种通配符："><a href="#Aspect支持3种通配符：" class="headerlink" title="@Aspect支持3种通配符："></a>@Aspect支持3种通配符：</h2><p>*匹配任意字符，但它只能匹配上下文中的一个元素</p>
<p>..匹配任意字符，可以匹配上下文中的多个元素，但在表示类时，必须和*联合使用，而在表示入参时则单独使用。</p>
<p>+表示按类型匹配指定类及其子孙类，必须跟在类名后面。如cn.framelife.spring.UserService+表示UserService类及其子类。</p>
<h2 id="函数支持："><a href="#函数支持：" class="headerlink" title="函数支持："></a>函数支持：</h2><p>支持所有的通配符的函数：execution()、within()</p>
<p>仅支持+通配符的函数:args()、this()、targ()。虽然这三个函数可以支持+通配符，但对于这些函数来说使用和不使用+都是一样的。</p>
<p>不支持通配符的函数:@args、@within、@target()、@annotation()。也就是所有用于注解上的函数都不支持通配符。</p>
<h2 id="Aspectj支持的逻辑运算符："><a href="#Aspectj支持的逻辑运算符：" class="headerlink" title="@Aspectj支持的逻辑运算符："></a>@Aspectj支持的逻辑运算符：</h2><p>&amp;&amp;与</p>
<p>||或</p>
<p>!非</p>
</div><script type="text/javascript" src="/js/share.js?v=1.0.4" async></script><a data-url="http://ibenben.org/2013/07/08/9268637/" data-id="cjozgqnps00na6gv86jqifixx" class="article-share-link">分享</a><div class="tags"><a href="/tags/Spring/">Spring</a><a href="/tags/AOP/">AOP</a><a href="/tags/AspectJ/">AspectJ</a></div><div class="post-nav"><a href="/2013/07/08/9269407/" class="pre">第三章 AOP 基于Schema的AOP</a><a href="/2013/07/05/9253149/" class="next">hadoop的一些名词解释</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2013-2018 <a href="/." rel="nofollow">笨笨个人笔记.</a></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.4" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.4" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.4"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.4"></script><script type="text/javascript" src="/js/prism.js?v=1.0.4"></script></div></body></html>