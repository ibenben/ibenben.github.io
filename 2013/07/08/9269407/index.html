<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>第三章 AOP 基于Schema的AOP | 笨笨个人笔记</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="/css/main.css?v=1.0.4"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body style="background:#fbfbfb;"><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">第三章 AOP 基于Schema的AOP</h1><a id="logo" href="/.">笨笨个人笔记</a><p class="description">ibenben.org</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">第三章 AOP 基于Schema的AOP</h1><div class="post-meta">Jul 8, 2013<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><p>基于Schema定义的切面和前现两种方式定义的切面，内容上都差不多，只是表现形式不一样而已。</p>
<hr>
<h2 id="3-7-1一般增强的使用"><a href="#3-7-1一般增强的使用" class="headerlink" title="3.7.1一般增强的使用"></a>3.7.1一般增强的使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class Target &#123;</span><br><span class="line">	public void say()&#123;</span><br><span class="line">		System.out.println(&quot;say...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public String getName(int id,String name)&#123;</span><br><span class="line">		System.out.println(&quot;getName...&quot;);</span><br><span class="line">		return &quot;MR&quot;+name+id;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void around()&#123;</span><br><span class="line">		System.out.println(&quot;around...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void targetThrow()&#123;</span><br><span class="line">		System.out.println(&quot;targetThrow&quot;);</span><br><span class="line">		throw new RuntimeException(&quot;我是一个运行期异常...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POJO(</p>
<p>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public class Pojo &#123;</span><br><span class="line">	public void before() &#123;</span><br><span class="line">		System.out.println(&quot;前置增强&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void afterReturning(String retName, int id, String name) &#123;</span><br><span class="line">		System.out.println(&quot;后置增强，返回值为：&quot;+retName+&quot; 入参为：&quot;+id+&quot;-&quot;+name);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public Object around(ProceedingJoinPoint point) throws Throwable&#123;</span><br><span class="line">		System.out.println(&quot;方法执行之前&quot;);</span><br><span class="line">		Object object = point.proceed();</span><br><span class="line">		System.out.println(&quot;方法执行之后&quot;);</span><br><span class="line">		return object;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void throwEx(Exception ex)&#123;</span><br><span class="line">		System.out.println(&quot;抛出异常增强，异常信息:&quot;+ex.getMessage());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void finalEx()&#123;</span><br><span class="line">		System.out.println(&quot;Final增强&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>c、</p>
<p>aop</p>
<p>命名空间与</p>
<p>Schema</p>
<p>方式配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;</span><br><span class="line">	&lt;!-- 目标类 --&gt;</span><br><span class="line">	&lt;bean id=&quot;target&quot; class=&quot;cn.framelife.spring.schema.Target&quot;&gt;&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 增强所在的类 --&gt;</span><br><span class="line">	&lt;bean id=&quot;advisor&quot; class=&quot;cn.framelife.spring.schema.Pojo&quot;&gt;&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 配置基于schema的切面 --&gt;</span><br><span class="line">	&lt;aop:config proxy-target-class=&quot;true&quot;&gt;</span><br><span class="line">		&lt;!-- 确定增强所在类，并引入 --&gt;</span><br><span class="line">		&lt;aop:aspect ref=&quot;advisor&quot;&gt;</span><br><span class="line">			&lt;!—</span><br><span class="line">                          前置增强 </span><br><span class="line">                          method是配置增强所在类中的方法</span><br><span class="line">                        --&gt;</span><br><span class="line">			&lt;aop:before method=&quot;before&quot; pointcut=&quot;target(cn.framelife.spring.schema.Target)&quot;/&gt;</span><br><span class="line">		</span><br><span class="line">			&lt;!—</span><br><span class="line">                          后置增强 </span><br><span class="line">                          Returning 是返回值，必须和method中的参数名是一样的</span><br><span class="line">                          在Schema配置中，多个切点函数的与操作是and，或操作是or</span><br><span class="line">                        --&gt;</span><br><span class="line">			&lt;aop:after-returning method=&quot;afterReturning&quot; pointcut=&quot;execution(* cn.framelife.spring.schema..getName(..)) and args(id,name)&quot; returning=&quot;retName&quot; arg-names=&quot;retName,id,name&quot;/&gt;</span><br><span class="line">		</span><br><span class="line">			&lt;!-- 环绕增强 --&gt;</span><br><span class="line">			&lt;aop:around method=&quot;around&quot; pointcut=&quot;execution(* cn.framelife.spring.schema..around(..))&quot;/&gt;</span><br><span class="line">		</span><br><span class="line">			&lt;!—</span><br><span class="line">                         抛出异常增强 </span><br><span class="line">                         throwing是异常对象，必须和method中的参数是一样的</span><br><span class="line">                        --&gt;</span><br><span class="line">			&lt;aop:after-throwing method=&quot;throwEx&quot; pointcut=&quot;execution(* cn.framelife.spring.schema..targetThrow(..))&quot; throwing=&quot;ex&quot;/&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;!-- Final增强 --&gt;</span><br><span class="line">			&lt;aop:after method=&quot;finalEx&quot; pointcut=&quot;execution(* cn.framelife.spring.schema..targetThrow(..))&quot;/&gt;</span><br><span class="line">	&lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		Target target = (Target) context.getBean(&quot;target&quot;);</span><br><span class="line">		target.say();</span><br><span class="line">		target.getName(10, &quot;Zhang&quot;);</span><br><span class="line">		target.around();</span><br><span class="line">		target.targetThrow();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">前置增强</span><br><span class="line">say...</span><br><span class="line">前置增强</span><br><span class="line">getName...</span><br><span class="line">后置增强，返回值为：MRZhang10 入参为：10-Zhang</span><br><span class="line">前置增强</span><br><span class="line">方法执行之前</span><br><span class="line">around...</span><br><span class="line">方法执行之后</span><br><span class="line">前置增强</span><br><span class="line">targetThrow</span><br><span class="line">抛出异常增强，异常信息:我是一个运行期异常...</span><br><span class="line">Final增强</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.RuntimeException: 我是一个运行期异常...</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-7-2引介增强的使用"><a href="#3-7-2引介增强的使用" class="headerlink" title="3.7.2引介增强的使用"></a>3.7.2引介增强的使用</h2><p>我们还是使用3.6.2@DeclareParents中的例子：Waiter为目标类，然后让目标类拥有ISeller接口的功能：</p>
<p><a href="http://blog.csdn.net/p_3er/article/details/9269407" target="_blank" rel="noopener">http://blog.csdn.net/p_3er/article/details/9269407</a></p>
<p>a、两个接口与两个类</p>
<p>目标类与其接口：</p>
<p>[java]</p>
<p>view<br> plain</p>
<p>copy</p>
<p>print</p>
<p>?</p>
<ol>
<li>public interface IWaiter {</li>
<li>public void service();</li>
<li>}</li>
</ol>
<p>[java]</p>
<p>view<br> plain</p>
<p>copy</p>
<p>print</p>
<p>?</p>
<ol>
<li>@Component</li>
<li>public class Waiter implements IWaiter {</li>
<li>@Override</li>
<li>public void service() {</li>
<li>System.out.println(“service”);</li>
<li>}</li>
<li>}</li>
</ol>
<p>运行期织入到目标类的功能类与其接口：</p>
<p>[java]</p>
<p>view<br> plain</p>
<p>copy</p>
<p>print</p>
<p>?</p>
<ol>
<li>public interface ISeller {</li>
<li>public void sell();</li>
<li>}</li>
</ol>
<p>[java]</p>
<p>view<br> plain</p>
<p>copy</p>
<p>print</p>
<p>?</p>
<ol>
<li>public class Seller implements ISeller {</li>
<li>@Override</li>
<li>public void sell() {</li>
<li>System.out.println(“sell”);</li>
<li>}</li>
<li>}</li>
</ol>
<p>b、配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;</span><br><span class="line">	&lt;!-- 目标类 --&gt;</span><br><span class="line">	&lt;bean id=&quot;waiter&quot; class=&quot;cn.framelife.spring.schema.Waiter&quot;&gt;&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 增强所在的类 --&gt;</span><br><span class="line">	&lt;bean id=&quot;advisor&quot; class=&quot;cn.framelife.spring.schema.Pojo&quot;&gt;&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;aop:config proxy-target-class=&quot;true&quot;&gt;</span><br><span class="line">		&lt;!—</span><br><span class="line">虽然引介增强不需要在增强所在的类中定义一个方法用于增强的实现，但&lt;aop:aspect ref=&quot;advisor&quot;&gt;中的ref属性依然要指定一个增强Bean</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">		&lt;aop:aspect ref=&quot;advisor&quot;&gt;</span><br><span class="line">			&lt;!—</span><br><span class="line">引介增强 </span><br><span class="line">	types-matching 目标类</span><br><span class="line">	implement-interface 要织入目标类的接口</span><br><span class="line">	default-impl 织入接口的实现类</span><br><span class="line">--&gt;</span><br><span class="line">			&lt;aop:declare-parents </span><br><span class="line">				types-matching=&quot;cn.framelife.spring.schema.IWaiter+&quot; </span><br><span class="line">				implement-interface=&quot;cn.framelife.spring.schema.ISeller&quot;</span><br><span class="line">				default-impl=&quot;cn.framelife.spring.schema.Seller&quot;/&gt;</span><br><span class="line">		&lt;/aop:aspect&gt;</span><br><span class="line">	&lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p>c、测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;applicationContext.xml&quot;&#125;);</span><br><span class="line">		IWaiter waiter = (IWaiter) context.getBean(&quot;waiter&quot;);</span><br><span class="line">		waiter.service();</span><br><span class="line">		ISeller seller = (ISeller)waiter;</span><br><span class="line">		seller.sell();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service</span><br><span class="line">sell</span><br></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=1.0.4" async></script><a data-url="http://ibenben.org/2013/07/08/9269407/" data-id="cjozgqnpp00n56gv8t77d7pbf" class="article-share-link">分享</a><div class="tags"></div><div class="post-nav"><a href="/2013/07/08/9269461/" class="pre">第三章 AOP 编程选择</a><a href="/2013/07/08/9268637/" class="next">第三章 AOP 基于@Aspect的AOP</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2013-2018 <a href="/." rel="nofollow">笨笨个人笔记.</a></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.4" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.4" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.4"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.4"></script><script type="text/javascript" src="/js/prism.js?v=1.0.4"></script></div></body></html>