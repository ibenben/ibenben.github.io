<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Nodejs+Extjs+Mongodb开发第一天  Nodejs环境搭建 | 笨笨个人笔记</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="/css/main.css?v=1.0.4"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body style="background:#fbfbfb;"><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Nodejs+Extjs+Mongodb开发第一天  Nodejs环境搭建</h1><a id="logo" href="/.">笨笨个人笔记</a><p class="description">ibenben.org</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Nodejs+Extjs+Mongodb开发第一天  Nodejs环境搭建</h1><div class="post-meta">Aug 26, 2014<span> | </span><span class="category"><a href="/categories/Nodejs/">Nodejs</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h2 id="一、装备"><a href="#一、装备" class="headerlink" title="一、装备"></a>一、装备</h2><p>我个人PC环境是Ubuntu14+JDK7，所以下面的步骤及问题也是基于此进行及产生的。</p>
<h2 id="二、Nodejs及npm的安装"><a href="#二、Nodejs及npm的安装" class="headerlink" title="二、Nodejs及npm的安装"></a>二、Nodejs及npm的安装</h2><p>这个安装的过程在网上有很多教程，这里就不详细讲了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python </span><br><span class="line"></span><br><span class="line">$ sudo apt-get install build-essential </span><br><span class="line"></span><br><span class="line">$ sudo apt-get install gcc </span><br><span class="line"></span><br><span class="line">$ sudo apt-get install g++ </span><br><span class="line"></span><br><span class="line">$ sudo apt-get install nodejs</span><br><span class="line"></span><br><span class="line">$ sudo apt-get install npm</span><br></pre></td></tr></table></figure></p>
<p>查看Nodejs的版本,网上很多教程都写的是:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>
<p>但一直node命令找不到的异常，使用以下命令执行成功:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nodejs -v</span><br></pre></td></tr></table></figure>
<p>终端显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v0.10.25</span><br></pre></td></tr></table></figure>
<p>查看npm版本是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm -v </span><br><span class="line">1.3.10</span><br></pre></td></tr></table></figure>
<h2 id="三、使用npm来安装supervisor工具及express框架"><a href="#三、使用npm来安装supervisor工具及express框架" class="headerlink" title="三、使用npm来安装supervisor工具及express框架"></a>三、使用npm来安装supervisor工具及express框架</h2><p><strong>1、supervisor </strong></p>
<p>a) 全局安装 （我的选择）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install supervisor -gd</span><br></pre></td></tr></table></figure>
<p>b) 安装在当前文件夹下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install supervisor</span><br></pre></td></tr></table></figure>
<p>安装成功后，命令行会提示 npm info ok</p>
<p>-g代表安装到NODE_PATH的lib里面，而-d代表把相依性套件也一起安装。如果沒有-g的话会安装目前所在的目录(会建立一个node_modules的文件夹)。</p>
<p>通过以下命令了查看supervisor的帮助文档，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisor -hellp</span><br></pre></td></tr></table></figure>
<p>终端显示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/env: node: 没有那个文件或目录</span><br></pre></td></tr></table></figure>
<p>经查找后，发现npm在安装模块的时候，会把源码及执行文件分开。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/lib/node_modules  源码目录</span><br><span class="line">/usr/local/bin  执行文件目录</span><br></pre></td></tr></table></figure>
<p>注意：这里也是和网上的大部分教程不一样的地方，网上的教程都说源码及执行文件都是放在/usr/local/lib/node_modules 目录下的，估计是npm版本不同的原因。</p>
<p>找到并查看supervisor的执行文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env node </span><br><span class="line">var path = require(&quot;path&quot;) </span><br><span class="line">  , fs = require(&quot;fs&quot;) </span><br><span class="line">  , args = process.argv.slice(1) </span><br><span class="line"></span><br><span class="line">var arg, base; </span><br><span class="line">do arg = args.shift(); </span><br><span class="line">while ( fs.realpathSync(arg) !== __filename </span><br><span class="line">  &amp;&amp; (base = path.basename(arg)) !== &quot;node-supervisor&quot; </span><br><span class="line">  &amp;&amp; base !== &quot;supervisor&quot; </span><br><span class="line">  &amp;&amp; base !== &quot;supervisor.js&quot; </span><br><span class="line">) </span><br><span class="line"></span><br><span class="line">require(&quot;./supervisor&quot;).run(args)</span><br></pre></td></tr></table></figure></p>
<p>看到supervisor的介绍，我们很容易得知，这个小模块的主要功能有两个：</p>
<p>1、关闭正在执行的项目</p>
<p>2、启动前面关闭的项目</p>
<p>这里报的错误是没有找到node，而且很清楚地发现执行文件的第一行使用的命令是!/usr/bin/env node ，回想前面查看Nodejs版本的命令。项目启动用到的应该是Nodejs本身的命令nodejs,</p>
<p>于是将这一行修改如下进行尝试，问题得到解决。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env nodejs</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">Node Supervisor is used to restart programs when they crash. </span><br><span class="line"></span><br><span class="line">It can also be used to restart programs when a *.js file changes. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Usage: </span><br><span class="line"></span><br><span class="line">  supervisor [options] &lt;program&gt; </span><br><span class="line"></span><br><span class="line">  supervisor [options] -- &lt;program&gt; [args ...] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Required: </span><br><span class="line"></span><br><span class="line">  &lt;program&gt; </span><br><span class="line"></span><br><span class="line">    The program to run. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Options: </span><br><span class="line"></span><br><span class="line">  -w|--watch &lt;watchItems&gt; </span><br><span class="line"></span><br><span class="line">    A comma-delimited list of folders or js files to watch for changes. </span><br><span class="line"></span><br><span class="line">    When a change to a js file occurs, reload the program </span><br><span class="line"></span><br><span class="line">    Default is &apos;.&apos; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  -i|--ignore &lt;ignoreItems&gt; </span><br><span class="line"></span><br><span class="line">    A comma-delimited list of folders to ignore for changes. </span><br><span class="line"></span><br><span class="line">    No default </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  -p|--poll-interval &lt;milliseconds&gt; </span><br><span class="line"></span><br><span class="line">    How often to poll watched files for changes. </span><br><span class="line"></span><br><span class="line">    Defaults to Node default. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">  -e|--extensions &lt;extensions&gt; </span><br><span class="line"></span><br><span class="line">    Specific file extensions to watch in addition to defaults. </span><br><span class="line"></span><br><span class="line">    Used when --watch option includes folders </span><br><span class="line"></span><br><span class="line">    Default is &apos;node,js&apos; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  -x|--exec &lt;executable&gt; </span><br><span class="line"></span><br><span class="line">    The executable that runs the specified program. </span><br><span class="line"></span><br><span class="line">    Default is &apos;node&apos; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  --debug </span><br><span class="line"></span><br><span class="line">    Start node with --debug flag. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  --debug-brk[=port] </span><br><span class="line"></span><br><span class="line">    Start node with --debug-brk[=port] flag. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  --harmony </span><br><span class="line"></span><br><span class="line">    Start node with --harmony flag. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  -n|--no-restart-on error|exit </span><br><span class="line"></span><br><span class="line">    Don&apos;t automatically restart the supervised program if it ends. </span><br><span class="line"></span><br><span class="line">    Supervisor will wait for a change in the source files. </span><br><span class="line"></span><br><span class="line">    If &quot;error&quot;, an exit code of 0 will still restart. </span><br><span class="line"></span><br><span class="line">    If &quot;exit&quot;, no restart regardless of exit code. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  --force-watch </span><br><span class="line"></span><br><span class="line">    Use fs.watch instead of fs.watchFile. </span><br><span class="line"> </span><br><span class="line">    This may be useful if you see a high cpu load on a windows machine. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  -h|--help|-? </span><br><span class="line"></span><br><span class="line">    Display these usage instructions. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  -q|--quiet </span><br><span class="line"></span><br><span class="line">    Suppress DEBUG messages </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  -V|--verbose </span><br><span class="line"></span><br><span class="line">    Show extra DEBUG messages </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Examples: </span><br><span class="line"></span><br><span class="line">  supervisor myapp.js </span><br><span class="line"></span><br><span class="line">  supervisor myapp.coffee </span><br><span class="line"></span><br><span class="line">  supervisor -w scripts -e myext -x myrunner myapp </span><br><span class="line"></span><br><span class="line">  supervisor -- server.js -h host -p port</span><br></pre></td></tr></table></figure>
<p>注意:根据帮助文档，查看supervisor的命令是supervisor -V 。命令中的V是大写，安装过程中我发现windows下小写也行，但在我的ubuntu14的环境下必须是大写。</p>
<p><strong>2、express </strong></p>
<p>a) 全局安装 （我的选择）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express -gd</span><br></pre></td></tr></table></figure>
<p>b) 安装在当前文件夹下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install  express</span><br></pre></td></tr></table></figure>
<p>在安装完后，express与supervisor一样，也存在Nodejs命令不符合的问题，同样的方式找到执行文件进行修改此命令即可。</p>
<p>安装完了express,如果版本是4.0及以上的话，还要安装另外一个模块，express才能使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g express-generator</span><br></pre></td></tr></table></figure>
<h2 id="四、项目的建立及执行"><a href="#四、项目的建立及执行" class="headerlink" title="四、项目的建立及执行"></a>四、项目的建立及执行</h2><p><strong>1、新建一个名称为test的项目</strong></p>
<p><strong>2、使用express框架</strong></p>
<p>cd 到test目录的上级目录，执行以下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">express -e test</span><br></pre></td></tr></table></figure>
<p>执行完后，回到项目目录查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">node_modules, 存放所有的项目依赖库。 </span><br><span class="line">package.json，项目依赖配置及开发者信息 </span><br><span class="line">app.js，程序启动文件 </span><br><span class="line">public，静态文件(css,js,img) </span><br><span class="line">routes，路由文件(MVC中的C,controller) </span><br><span class="line">views，页面文件(Ejs模板) </span><br><span class="line">bin ，存放默认启动的脚本</span><br></pre></td></tr></table></figure>
<p>package.json ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;pcrm&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;0.0.1&quot;,</span><br><span class="line">  &quot;private&quot;: true,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;node ./bin/www&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;express&quot;: &quot;~4.2.0&quot;,</span><br><span class="line">    &quot;static-favicon&quot;: &quot;~1.0.0&quot;,</span><br><span class="line">    &quot;morgan&quot;: &quot;~1.0.0&quot;,</span><br><span class="line">    &quot;cookie-parser&quot;: &quot;~1.0.1&quot;,</span><br><span class="line">    &quot;body-parser&quot;: &quot;~1.0.0&quot;,</span><br><span class="line">    &quot;debug&quot;: &quot;~0.7.4&quot;,</span><br><span class="line">    &quot;ejs&quot;: &quot;~0.8.5&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>app.js:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var path = require(&apos;path&apos;);</span><br><span class="line">var favicon = require(&apos;static-favicon&apos;);</span><br><span class="line">var logger = require(&apos;morgan&apos;);</span><br><span class="line">var cookieParser = require(&apos;cookie-parser&apos;);</span><br><span class="line">var bodyParser = require(&apos;body-parser&apos;);</span><br><span class="line"> </span><br><span class="line">var routes = require(&apos;./routes/index&apos;);</span><br><span class="line">var users = require(&apos;./routes/users&apos;);</span><br><span class="line"> </span><br><span class="line">var app = express();</span><br><span class="line"> </span><br><span class="line">// view engine setup</span><br><span class="line">app.set(&apos;views&apos;, path.join(__dirname, &apos;views&apos;));</span><br><span class="line">app.set(&apos;view engine&apos;, &apos;ejs&apos;);</span><br><span class="line"> </span><br><span class="line">app.use(favicon());</span><br><span class="line">app.use(logger(&apos;dev&apos;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded());</span><br><span class="line">app.use(cookieParser());</span><br><span class="line">app.use(express.static(path.join(__dirname, &apos;public&apos;)));</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">app.use(&apos;/&apos;, routes);</span><br><span class="line">app.use(&apos;/users&apos;, users);</span><br><span class="line"> </span><br><span class="line">/// catch 404 and forward to error handler</span><br><span class="line">app.use(function(req, res, next) &#123;</span><br><span class="line">    var err = new Error(&apos;Not Found&apos;);</span><br><span class="line">    err.status = 404;</span><br><span class="line">    next(err);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">/// error handlers</span><br><span class="line"> </span><br><span class="line">// development error handler</span><br><span class="line">// will print stacktrace</span><br><span class="line">if (app.get(&apos;env&apos;) === &apos;development&apos;) &#123;</span><br><span class="line">    app.use(function(err, req, res, next) &#123;</span><br><span class="line">        res.status(err.status || 500);</span><br><span class="line">        res.render(&apos;error&apos;, &#123;</span><br><span class="line">            message: err.message,</span><br><span class="line">            error: err</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">// production error handler</span><br><span class="line">// no stacktraces leaked to user</span><br><span class="line">app.use(function(err, req, res, next) &#123;</span><br><span class="line">    res.status(err.status || 500);</span><br><span class="line">    res.render(&apos;error&apos;, &#123;</span><br><span class="line">        message: err.message,</span><br><span class="line">        error: &#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">module.exports = app;</span><br></pre></td></tr></table></figure>
<p>bin/www:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env node</span><br><span class="line">var debug = require(&apos;debug&apos;)(&apos;pcrm&apos;);</span><br><span class="line">var app = require(&apos;../app&apos;);</span><br><span class="line"> </span><br><span class="line">app.set(&apos;port&apos;, process.env.PORT || 3000);</span><br><span class="line"> </span><br><span class="line">var server = app.listen(app.get(&apos;port&apos;), function() &#123;</span><br><span class="line">  debug(&apos;Express server listening on port &apos; + server.address().port);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>3、执行</strong></p>
<p>cd到test目录下</p>
<p>执行方法1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>
<p>终端显示异常:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; test@0.0.1 start /home/benben/workspace/test</span><br><span class="line">&gt; node ./bin/www</span><br><span class="line"> </span><br><span class="line">sh: 1: node: not found</span><br><span class="line">npm ERR! weird error 127</span><br><span class="line">npm WARN This failure might be due to the use of legacy binary &quot;node&quot;</span><br><span class="line">npm WARN For further explanations, please read</span><br><span class="line">/usr/share/doc/nodejs/README.Debian</span><br><span class="line"> </span><br><span class="line">npm ERR! not ok code 0</span><br></pre></td></tr></table></figure>
<p>还是node命令的问题，修改package.json 文件中的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;start&quot;: &quot;node ./bin/www&quot;  为  &quot;start&quot;: &quot;nodejs ./bin/www&quot;</span><br></pre></td></tr></table></figure>
<p>bin/www文件中的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env node 为 #!/usr/bin/env nodejs</span><br></pre></td></tr></table></figure>
<p>执行成功</p>
<p>npm是什么东西呢？大部分的Java程序员都使用过Maven。而npm的职能与Maven相似,是Nodejs的包管理工具，可以使用它来下载包、查看文件等功能用express创建的应用程序是一个符合CommonJS规范的一个nodejs包npm执行的时候会读取当前目录的package.json文件，这个也就是我上面那个bug出现的原因执行npm start其实是执行package.json中的script对应的对象中的start属性所对应的命令。</p>
<p>所以其实如果吧package.json中的start改成test或者其他字符串，然后你在终端敲上npm test/或者其他，程序照样会运行 。</p>
<p>其实package.json就是一个配置文件，只是我们之前用的xml格式，但是在nodejs用的是json可以，简单容易理解。从package.json我们可以看出来npm start其实执行的是./bin/www里面是创建一个服务器然后监听3000端口，所以我们可以在浏览器中通过输入”localhost:3000”来访问应用程序。</p>
<p>执行方法2：</p>
<p>npm start 是启用的 /bin/www文件里的脚本</p>
<p>如果你想用nodejs 启动服务 可以在app.js中添加如下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>
<p>注意：上面的语句得加在module.exports = app;之前。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nodejs app.js</span><br></pre></td></tr></table></figure>
<p>得到同样的结果。</p>
<p>执行方法3：</p>
<p>使用supervisor进行热部署的执行方便调试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisor app.js</span><br></pre></td></tr></table></figure>
<p>终端显示异常:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Running node-supervisor with</span><br><span class="line">  program &apos;app.js&apos;</span><br><span class="line">  --watch &apos;.&apos;</span><br><span class="line">  --extensions &apos;node,js&apos;</span><br><span class="line">  --exec &apos;node&apos;</span><br><span class="line"> </span><br><span class="line">Starting child process with &apos;node app.js&apos;</span><br><span class="line">execvp(): No such file or directory</span><br><span class="line">Watching directory &apos;/home/benben/workspace/pcrm&apos; for changes.</span><br><span class="line"> </span><br><span class="line">events.js:72</span><br><span class="line">        throw er; // Unhandled &apos;error&apos; event</span><br><span class="line">              ^</span><br><span class="line">Error: spawn ENOENT</span><br><span class="line">    at errnoException (child_process.js:988:11)</span><br><span class="line">    at Process.ChildProcess._handle.onexit (child_process.js:779:34)</span><br></pre></td></tr></table></figure>
<p>这里解决的过程就不详细说了，重点是–exec ‘node’这个，会发现supervisor执行的还是node命令，而不是nodejs。修改supervisor源文件目录下的supervisor.js文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (!executor) &#123; </span><br><span class="line">   executor = (programExt === &quot;coffee&quot; || programExt === &quot;litcoffee&quot;) ? &quot;coffee&quot; : &quot;node&quot;; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (!executor) &#123; </span><br><span class="line">   executor = (programExt === &quot;coffee&quot; || programExt === &quot;litcoffee&quot;) ? &quot;coffee&quot; : &quot;nodejs&quot;; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>再次执行成功，项目修改后，Nodejs也会自动重启。</p>
<h2 id="五、IDE的选择"><a href="#五、IDE的选择" class="headerlink" title="五、IDE的选择"></a>五、IDE的选择</h2></div><script type="text/javascript" src="/js/share.js?v=1.0.4" async></script><a data-url="http://ibenben.org/2014/08/26/38845639/" data-id="cjozgqng2002p6gv88rtewac3" class="article-share-link">分享</a><div class="tags"><a href="/tags/ubuntu/">ubuntu</a><a href="/tags/nodejs/">nodejs</a><a href="/tags/supervisor/">supervisor</a><a href="/tags/express/">express</a><a href="/tags/npm/">npm</a></div><div class="post-nav"><a href="/2014/09/01/38976047/" class="pre">10个强大的Apache开源模块</a><a href="/2014/08/22/38762041/" class="next">eclipse Maven构建的工程无法发布lib到tomcat的解决方法</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2013-2018 <a href="/." rel="nofollow">笨笨个人笔记.</a></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.4" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.4" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.4"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.4"></script><script type="text/javascript" src="/js/prism.js?v=1.0.4"></script></div></body></html>